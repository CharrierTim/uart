
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation of the UART Project">
      
      
        <meta name="author" content="Timothée Charrier">
      
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>UART RX - UART Project</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#uart-rx" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="UART Project" class="md-header__button md-logo" aria-label="UART Project" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            UART Project
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              UART RX
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../top_fpga/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../bench/" class="md-tabs__link">
        
  
  
    
  
  Testbench

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="UART Project" class="md-nav__button md-logo" aria-label="UART Project" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    UART Project
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../top_fpga/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Top FPGA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resync_slv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Resync slv
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../regfile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Registers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UART
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spi_master/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SPI Master
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bench/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testbench
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    <span class="md-ellipsis">
      
        Description
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generics
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inputs-and-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inputs and Outputs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oversampling-clock" class="md-nav__link">
    <span class="md-ellipsis">
      
        Oversampling Clock
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-synchronization-and-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Input Synchronization and Filtering
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oversampling-and-bit-timing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Oversampling and Bit Timing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bit-counter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bit Counter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-shift-register" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Shift Register
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-recovery-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Recovery Mechanism
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fsm" class="md-nav__link">
    <span class="md-ellipsis">
      
        FSM
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="uart-rx">UART RX</h1>
<h2 id="description">Description</h2>
<h2 id="generics">Generics</h2>
<table>
<thead>
<tr>
<th>Generic Name</th>
<th>Type</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>G_CLK_FREQ_HZ</code></td>
<td>positive</td>
<td>0d50_000_000</td>
<td>Clock frequency in Hz of <code>CLK</code></td>
</tr>
<tr>
<td><code>G_BAUD_RATE_BPS</code></td>
<td>positive</td>
<td>0d115_200</td>
<td>Baud rate in bps</td>
</tr>
<tr>
<td><code>G_SAMPLING_RATE</code></td>
<td>positive</td>
<td>0d16</td>
<td>Sampling rate (number of clock cycles per bit)</td>
</tr>
<tr>
<td><code>G_NB_DATA_BITS</code></td>
<td>positive</td>
<td>0d8</td>
<td>Number of data bits</td>
</tr>
</tbody>
</table>
<h2 id="inputs-and-outputs">Inputs and Outputs</h2>
<table>
<thead>
<tr>
<th>Port Name</th>
<th>Type</th>
<th>Direction</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CLK</code></td>
<td>std_logic</td>
<td>in</td>
<td>-</td>
<td>Input clock</td>
</tr>
<tr>
<td><code>RST_N</code></td>
<td>std_logic</td>
<td>in</td>
<td>-</td>
<td>Input asynchronous reset, active low</td>
</tr>
<tr>
<td><code>I_UART_RX</code></td>
<td>std_logic</td>
<td>in</td>
<td>-</td>
<td>Asynchronous input UART RX line</td>
</tr>
<tr>
<td><code>O_BYTE</code></td>
<td>vector[7:0]</td>
<td>out</td>
<td>0x00</td>
<td>Output byte</td>
</tr>
<tr>
<td><code>O_BYTE_VALID</code></td>
<td>std_logic</td>
<td>out</td>
<td>0x0</td>
<td>Output byte valid flag</td>
</tr>
<tr>
<td><code>O_START_BIT_ERROR</code></td>
<td>std_logic</td>
<td>out</td>
<td>0x0</td>
<td>Output start bit error flag</td>
</tr>
<tr>
<td><code>O_STOP_BIT_ERROR</code></td>
<td>std_logic</td>
<td>out</td>
<td>0x0</td>
<td>Output stop bit error flag</td>
</tr>
</tbody>
</table>
<h2 id="architecture">Architecture</h2>
<p>The UART receiver must synchronize to incoming data, sample at the correct time, handle noise, and detect framing errors. The receiver uses oversampling, digital filtering, and majority voting to ensure reliable data reception.</p>
<h3 id="oversampling-clock">Oversampling Clock</h3>
<p>The receiver generates an internal sampling clock that runs at a multiple of the baud rate (configured by <code>G_SAMPLING_RATE</code>, typically 16).</p>
<p>The oversampling clock divider generates a tick (<code>rx_baud_tick</code>) at the oversampling rate. For example, with 16× oversampling and 115200 baud:</p>
<div class="arithmatex">\[f_{oversample} = 115200 \times 16 = 1.8432\text{ MHz}\]</div>
<p>The clock divider is enabled during active reception and reset during idle to ensure proper synchronization with incoming data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The oversampling rate is configurable via the <code>G_SAMPLING_RATE</code> generic. A higher rate provides better noise immunity but requires a faster system clock.</p>
</div>
<h3 id="input-synchronization-and-filtering">Input Synchronization and Filtering</h3>
<p>The asynchronous UART RX input must be properly synchronized to prevent metastability and filtered to remove noise.</p>
<p><strong>Synchronization Chain</strong></p>
<p>A 5-stage shift register processes the incoming signal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Stage 0-1: Metastability resolution (2 flip-flops)
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>Stage 2-4: Digital filtering (3 consecutive samples)
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>I_UART_RX → [FF] → [FF] → [Filter] → [Filter] → [Filter] → i_uart_rx_filtered
</code></pre></div>
<p><strong>Digital Filtering Logic</strong></p>
<p>The filter uses a simple majority voting algorithm on the last 3 stages:</p>
<table>
<thead>
<tr>
<th>Input Samples (bits 4:2)</th>
<th>Filtered Output</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>000</code></td>
<td><code>0</code></td>
<td>All zeros → output low</td>
</tr>
<tr>
<td><code>111</code></td>
<td><code>1</code></td>
<td>All ones → output high</td>
</tr>
<tr>
<td>Other patterns</td>
<td>Keep previous value</td>
<td>Insufficient agreement</td>
</tr>
</tbody>
</table>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The first 2 bits of the shift register are potentially metastable and must NOT be used for any logic decisions. Only bits [4:2] are used for filtering. (I made this mistake)</p>
</div>
<p><strong>Edge Detection</strong></p>
<p>A delayed version of the filtered signal (<code>i_uart_rx_filtered_d1</code>) is maintained to detect edges:</p>
<ul>
<li><strong>Falling edge</strong> (<code>1</code> → <code>0</code>): Indicates start bit detection</li>
<li><strong>Rising edge</strong> (<code>0</code> → <code>1</code>): Used for stop bit validation</li>
</ul>
<h3 id="oversampling-and-bit-timing">Oversampling and Bit Timing</h3>
<p>Each UART bit period is divided into multiple sampling intervals. With 16× oversampling, each bit period contains 16 ticks.</p>
<p><strong>Tick Counting</strong></p>
<p>The <code>oversampling_counter</code> counter tracks the position within the current bit period:</p>
<ul>
<li>Increments on each <code>rx_baud_tick</code></li>
<li>Resets to 0 after reaching <code>C_OVERSAMPLE_MAX</code> (15 for 16× oversampling)</li>
<li>When it wraps, one complete bit period has elapsed</li>
</ul>
<p><strong>Visual Timing Diagram</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Idle/Previous Bit                           Current Data Bit                           Next Bit
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>     (High)                                     (Low)                                   (High)
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>________________                                                                 __________________
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>                \                                                               /
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>                 \                                                             /
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>                  \                                                           /
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>                   \_________________________________________________________/
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>Tick:                 0  1  2  3  4  5  6  7  8  9  10  11  12  13  14  15
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>Samples:                                      ^
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>                                       Sample Point
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>Legend:
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>- 16 ticks per bit period (numbered 0-15)
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>- Samples taken at tick
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>- Provides maximum timing margin from bit edges
</code></pre></div>
<p><strong>Sample Point Selection</strong></p>
<p>The mid-bit sample point is calculated as:</p>
<div class="arithmatex">\[\text{mid bit} = \frac{G\_BAUD\_RATE\_BPS - 1}{2}\]</div>
<h3 id="bit-counter">Bit Counter</h3>
<p>The <code>data_counter</code> counter tracks how many data bits have been received.</p>
<h3 id="data-shift-register">Data Shift Register</h3>
<p>The <code>next_o_byte</code> register accumulates the incoming data bits.</p>
<p><strong>Shifting Operation</strong></p>
<p>Data is received <strong>LSB first</strong> (UART standard). Each new bit is shifted in from the left (MSB side):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">next_o_byte</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">uart_rx_sampled_bit</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">next_o_byte</span><span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</code></pre></div>
<p><strong>Example Reception Sequence</strong></p>
<p>Receiving byte <code>0x5A</code> (<code>0b01011010</code>):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Initial:      next_o_byte = xxxxxxxx
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>Bit 0 (D0=0): next_o_byte = 0xxxxxxx  (shift in 0)
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>Bit 1 (D1=1): next_o_byte = 10xxxxxx  (shift in 1)
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>Bit 2 (D2=0): next_o_byte = 010xxxxx  (shift in 0)
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>Bit 3 (D3=1): next_o_byte = 1010xxxx  (shift in 1)
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>Bit 4 (D4=1): next_o_byte = 11010xxx  (shift in 1)
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>Bit 5 (D5=0): next_o_byte = 011010xx  (shift in 0)
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>Bit 6 (D6=1): next_o_byte = 1011010x  (shift in 1)
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>Bit 7 (D7=0): next_o_byte = 01011010  (shift in 0)
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>Final:        next_o_byte = 0x5A ✓
</code></pre></div>
<p>The byte is complete after 8 bits and ready to be latched to the output if the stop bit is valid.</p>
<h3 id="error-recovery-mechanism">Error Recovery Mechanism</h3>
<p>When an invalid start bit is detected, the module enters an error recovery state to prevent false triggering on glitches or noise.</p>
<p>The module then waits for the following time before going back to idle and accept new RX requests:</p>
<div class="arithmatex">\[\text{RECOVERY\_PERIOD} = G\_SAMPLING\_RATE \times (G\_NB\_DATA\_BITS + 1)\]</div>
<p>This represents the time for almost one complete UART frame (data bits + stop bit) at the configured baud rate.</p>
<h3 id="fsm">FSM</h3>
<p>The UART RX FSM is defined as:</p>
<p><img alt="UART RX FSM" src="../../_static/svg/UART-UART-RX_FSM.svg" /></p>
<p>Where the following transitions are defined:</p>
<table>
<thead>
<tr>
<th>Transition</th>
<th>Condition(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>T0</td>
<td><code>i_uart_rx_filtered_d1 = 1</code> <strong>AND</strong> <code>i_uart_rx_filtered = 0</code> (falling edge on the UART line)</td>
</tr>
<tr>
<td>T1</td>
<td><code>rx_baud_tick = 1</code> <strong>AND</strong> <code>oversampling_counter = G_SAMPLING_RATE - 1</code> <strong>AND</strong> <code>uart_rx_sampled_bit = 1</code> (invalid start bit = 1)</td>
</tr>
<tr>
<td>T2</td>
<td>Automatic</td>
</tr>
<tr>
<td>T3</td>
<td><code>recovery_elapsed = 1</code></td>
</tr>
<tr>
<td>T4</td>
<td><code>rx_baud_tick = 1</code> <strong>AND</strong> <code>oversampling_counter = G_SAMPLING_RATE - 1</code> <strong>AND</strong> <code>uart_rx_sampled_bit = 0</code> (valid start bit = 0)</td>
</tr>
<tr>
<td>T5</td>
<td><code>rx_baud_tick = 1</code> <strong>AND</strong> <code>oversampling_counter = G_SAMPLING_RATE - 1</code> <strong>AND</strong> <code>data_counter = G_NB_DATA_BITS - 1</code></td>
</tr>
<tr>
<td>T6</td>
<td><code>rx_baud_tick = 1</code> <strong>AND</strong> <code>oversampling_counter = C_THREE_QUARTER_POINT - 1</code> <strong>AND</strong> <code>uart_rx_sampled_bit = 0</code> (invalid stop bit = 0)</td>
</tr>
<tr>
<td>T7</td>
<td>Automatic</td>
</tr>
<tr>
<td>T8</td>
<td><code>rx_baud_tick = 1</code> <strong>AND</strong> <code>oversampling_counter = C_THREE_QUARTER_POINT - 1</code> <strong>AND</strong> <code>uart_rx_sampled_bit = 1</code> (valid stop bit = 1)</td>
</tr>
<tr>
<td>T9</td>
<td>Automatic</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Early Stop Bit Exit for Burst Support</strong></p>
<p>The module exits the stop bit at <strong>3/4 of the bit period</strong> (tick 12 of 16) after validation at mid-point (tick 8). This enables zero-gap back-to-back frame reception for burst transmissions.</p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Timothée Charrier
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>