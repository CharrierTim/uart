Top FPGA
========

Description
-----------

Top-Level of the FPGA.

Generics
--------

.. list-table::
    :widths: 25 10 15 60
    :header-rows: 1

    - - Generic Name
      - Type
      - Default Value
      - Description
    - - ``G_GIT_ID``
      - vector[31:0]
      - 0x0000
      - Git ID containing the sources for the bitstream generation. Automatically set by
        the ``run_synthesis.tcl`` script.

Inputs and Outputs
------------------

.. list-table::
    :widths: 25 10 15 15 45
    :header-rows: 1

    - - Port Name
      - Type
      - Direction
      - Default Value
      - Description
    - - ``PAD_I_CLK``
      - std_logic
      - in
      - \-
      - Input clock
    - - ``PAD_RST_H``
      - std_logic
      - in
      - \-
      - Input asynchronous reset, active high
    - - ``PAD_I_UART_RX``
      - std_logic
      - in
      - \-
      - Input UART RX line
    - - ``PAD_O_UART_TX``
      - std_logic
      - out
      - 1
      - Output UART TX line
    - - ``PAD_I_SWITCH_0``
      - std_logic
      - in
      - \-
      - Input switch 0
    - - ``PAD_I_SWITCH_1``
      - std_logic
      - in
      - \-
      - Input switch 1
    - - ``PAD_I_SWITCH_2``
      - std_logic
      - in
      - \-
      - Input switch 2
    - - ``PAD_O_LED_0``
      - std_logic
      - out
      - 1
      - Output LED 0

Overview
--------

The following figure depicts the Top-Level:

.. image:: ../_static/svg/UART-TOP_FPGA.svg

Architecture
------------

Internal Reset
~~~~~~~~~~~~~~

The FPGA internal reset ``internal_rst_n`` signal is generated by combining two
conditions:

1. The external reset button ``PAD_I_RST_H`` (active-high)
2. The PLL lock status ``pll_locked``

This ensures that the internal logic remains in reset until both the reset button is
released **and** the PLL has achieved lock.

Resync-slv
~~~~~~~~~~

The FPGA instantiates the :doc:`resync_slv` module with the following generics:

.. list-table::
    :widths: 25 10 15 60
    :header-rows: 1

    - - Generic Name
      - Type
      - Default Value
      - Description
    - - ``G_WIDTH``
      - positive
      - 0d3
      - Width of the input/output vector
    - - ``G_DEFAULT_VALUE``
      - vector [G_WIDTH - 1:0]
      - 0b000
      - Default value of the output vector

UART
~~~~

The FPGA instantiates the :doc:`uart` module with the following generics:

.. list-table::
    :widths: 25 10 15 60
    :header-rows: 1

    - - Generic Name
      - Type
      - Default Value
      - Description
    - - ``G_CLK_FREQ_HZ``
      - positive
      - 0d50\_000\_000
      - Clock frequency in Hz of ``internal_clk``
    - - ``G_BAUD_RATE_BPS``
      - positive
      - 0d115\_200
      - Baud rate in bps
    - - ``G_SAMPLING_RATE``
      - positive
      - 0d16
      - Sampling rate (number of clock cycles per bit)
    - - ``G_NB_DATA_BITS``
      - positive
      - 0d8
      - Number of data bits

Regfile
~~~~~~~

The FPGA instantiates the :doc:`regfile` module with the following generics:

.. list-table::
    :widths: 25 10 15 60
    :header-rows: 1

    - - Generic Name
      - Type
      - Default Value
      - Description
    - - ``G_GIT_ID_MSB``
      - vector[15:0]
      - ``G_GIT_ID[31:16]``
      - 16 MSB of the git ID containing the sources for the bitstream generation
    - - ``G_GIT_ID_LSB``
      - vector[15:0]
      - ``G_GIT_ID[15:0]``
      - 16 LSB of the git ID containing the sources for the bitstream generation
